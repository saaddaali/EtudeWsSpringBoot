{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright (c) 2011 Vinay Pulim <vinay@milewise.com>\n * MIT Licensed\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Server = void 0;\nconst events_1 = require(\"events\");\nconst url = require(\"url\");\nconst utils_1 = require(\"./utils\");\nlet zlib;\ntry {\n  zlib = require('zlib');\n} catch (error) {}\nfunction isExpress(server) {\n  return typeof server.route === 'function' && typeof server.use === 'function';\n}\nfunction isPromiseLike(obj) {\n  return !!obj && typeof obj.then === 'function';\n}\nfunction getDateString(d) {\n  function pad(n) {\n    return n < 10 ? '0' + n : n;\n  }\n  return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) + 'Z';\n}\nclass Server extends events_1.EventEmitter {\n  constructor(server, path, services, wsdl, options) {\n    super();\n    options = options || {\n      path: path,\n      services: services\n    };\n    this.path = path;\n    this.services = services;\n    this.wsdl = wsdl;\n    this.suppressStack = options && options.suppressStack;\n    this.returnFault = options && options.returnFault;\n    this.onewayOptions = options && options.oneWay || {};\n    this.enableChunkedEncoding = options.enableChunkedEncoding === undefined ? true : !!options.enableChunkedEncoding;\n    this.callback = options.callback ? options.callback : () => {};\n    if (typeof path === 'string' && path[path.length - 1] !== '/') {\n      path += '/';\n    } else if (path instanceof RegExp && path.source[path.source.length - 1] !== '/') {\n      path = new RegExp(path.source + '(?:\\\\/|)');\n    }\n    wsdl.onReady(err => {\n      if (isExpress(server)) {\n        // handle only the required URL path for express server\n        server.route(path).all((req, res) => {\n          if (typeof this.authorizeConnection === 'function') {\n            if (!this.authorizeConnection(req, res)) {\n              res.end();\n              return;\n            }\n          }\n          this._requestListener(req, res);\n        });\n        this.callback(err, this);\n      } else {\n        const listeners = server.listeners('request').slice();\n        server.removeAllListeners('request');\n        server.addListener('request', (req, res) => {\n          if (typeof this.authorizeConnection === 'function') {\n            if (!this.authorizeConnection(req, res)) {\n              res.end();\n              return;\n            }\n          }\n          let reqPath = url.parse(req.url).pathname;\n          if (reqPath[reqPath.length - 1] !== '/') {\n            reqPath += '/';\n          }\n          if (path === reqPath || path instanceof RegExp && reqPath.match(path)) {\n            this._requestListener(req, res);\n          } else {\n            for (let i = 0, len = listeners.length; i < len; i++) {\n              listeners[i].call(this, req, res);\n            }\n          }\n        });\n        this.callback(err, this);\n      }\n    });\n    this._initializeOptions(options);\n  }\n  addSoapHeader(soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    return this.soapHeaders.push(soapHeader) - 1;\n  }\n  changeSoapHeader(index, soapHeader, name, namespace, xmlns) {\n    if (!this.soapHeaders) {\n      this.soapHeaders = [];\n    }\n    soapHeader = this._processSoapHeader(soapHeader, name, namespace, xmlns);\n    this.soapHeaders[index] = soapHeader;\n  }\n  getSoapHeaders() {\n    return this.soapHeaders;\n  }\n  clearSoapHeaders() {\n    this.soapHeaders = null;\n  }\n  _processSoapHeader(soapHeader, name, namespace, xmlns) {\n    switch (typeof soapHeader) {\n      case 'object':\n        return this.wsdl.objectToXML(soapHeader, name, namespace, xmlns, true);\n      case 'function':\n        const _this = this;\n        // arrow function does not support arguments variable\n        // tslint:disable-next-line\n        return function () {\n          const result = soapHeader.apply(null, arguments);\n          if (typeof result === 'object') {\n            return _this.wsdl.objectToXML(result, name, namespace, xmlns, true);\n          } else {\n            return result;\n          }\n        };\n      default:\n        return soapHeader;\n    }\n  }\n  _initializeOptions(options) {\n    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n    this.onewayOptions.statusCode = this.onewayOptions.responseCode || 200;\n    this.onewayOptions.emptyBody = !!this.onewayOptions.emptyBody;\n  }\n  _processRequestXml(req, res, xml) {\n    let error;\n    try {\n      if (typeof this.log === 'function') {\n        this.log('received', xml, req);\n      }\n      this._process(xml, req, res, (result, statusCode) => {\n        this._sendHttpResponse(res, statusCode, result);\n        if (typeof this.log === 'function') {\n          this.log('replied', result, req);\n        }\n      });\n    } catch (err) {\n      if (err.Fault !== undefined) {\n        return this._sendError(err.Fault, (result, statusCode) => {\n          this._sendHttpResponse(res, statusCode || 500, result);\n          if (typeof this.log === 'function') {\n            this.log('error', err, req);\n          }\n        }, new Date().toISOString());\n      } else {\n        error = err.stack ? this.suppressStack === true ? err.message : err.stack : err;\n        this._sendHttpResponse(res, /* statusCode */500, error);\n        if (typeof this.log === 'function') {\n          this.log('error', err, req);\n        }\n      }\n    }\n  }\n  _requestListener(req, res) {\n    const reqParse = url.parse(req.url);\n    const reqPath = reqParse.pathname;\n    const reqQuery = reqParse.search;\n    if (typeof this.log === 'function') {\n      this.log('info', 'Handling ' + req.method + ' on ' + req.url, req);\n    }\n    if (req.method === 'GET') {\n      if (reqQuery && reqQuery.toLowerCase().startsWith('?wsdl')) {\n        if (typeof this.log === 'function') {\n          this.log('info', 'Wants the WSDL', req);\n        }\n        res.setHeader('Content-Type', 'application/xml');\n        res.write(this.wsdl.toXML());\n      }\n      res.end();\n    } else if (req.method === 'POST') {\n      if (typeof req.headers['content-type'] !== 'undefined') {\n        res.setHeader('Content-Type', req.headers['content-type']);\n      } else {\n        res.setHeader('Content-Type', 'application/xml');\n      }\n      // request body is already provided by an express middleware\n      // in this case unzipping should also be done by the express middleware itself\n      if (req.body && req.body.length > 0) {\n        return this._processRequestXml(req, res, req.body.toString());\n      }\n      const chunks = [];\n      let gunzip;\n      let source = req;\n      if (req.headers['content-encoding'] === 'gzip') {\n        gunzip = zlib.createGunzip();\n        req.pipe(gunzip);\n        source = gunzip;\n      }\n      source.on('data', chunk => {\n        chunks.push(chunk);\n      });\n      source.on('end', () => {\n        const xml = Buffer.concat(chunks).toString();\n        this._processRequestXml(req, res, xml);\n      });\n    } else {\n      res.end();\n    }\n  }\n  _getSoapAction(req) {\n    if (typeof req.headers.soapaction === 'undefined') {\n      return;\n    }\n    const soapAction = req.headers.soapaction;\n    return soapAction.indexOf('\"') === 0 ? soapAction.slice(1, -1) : soapAction;\n  }\n  _process(input, req, res, cb) {\n    const pathname = url.parse(req.url).pathname.replace(/\\/$/, '');\n    const obj = this.wsdl.xmlToObject(input);\n    const body = obj.Body;\n    const headers = obj.Header;\n    let binding;\n    let methodName;\n    let serviceName;\n    let portName;\n    const includeTimestamp = obj.Header && obj.Header.Security && obj.Header.Security.Timestamp;\n    const authenticate = this.authenticate || function defaultAuthenticate() {\n      return true;\n    };\n    const callback = (result, statusCode) => {\n      const response = {\n        result: result\n      };\n      this.emit('response', response, methodName);\n      cb(response.result, statusCode);\n    };\n    const process = () => {\n      if (typeof this.log === 'function') {\n        this.log('info', 'Attempting to bind to ' + pathname, req);\n      }\n      // Avoid Cannot convert undefined or null to object due to Object.keys(body)\n      // and throw more meaningful error\n      if (!body) {\n        throw new Error('Failed to parse the SOAP Message body');\n      }\n      // use port.location and current url to find the right binding\n      binding = (() => {\n        const services = this.wsdl.definitions.services;\n        let firstPort;\n        let name;\n        for (name in services) {\n          serviceName = name;\n          const service = services[serviceName];\n          const ports = service.ports;\n          for (name in ports) {\n            portName = name;\n            const port = ports[portName];\n            const portPathname = url.parse(port.location).pathname.replace(/\\/$/, '');\n            if (typeof this.log === 'function') {\n              this.log('info', 'Trying ' + portName + ' from path ' + portPathname, req);\n            }\n            if (portPathname === pathname) {\n              return port.binding;\n            }\n            // The port path is almost always wrong for generated WSDLs\n            if (!firstPort) {\n              firstPort = port;\n            }\n          }\n        }\n        return !firstPort ? void 0 : firstPort.binding;\n      })();\n      if (!binding) {\n        throw new Error('Failed to bind to WSDL');\n      }\n      try {\n        const soapAction = this._getSoapAction(req);\n        const messageElemName = Object.keys(body)[0] === 'attributes' ? Object.keys(body)[1] : Object.keys(body)[0];\n        const pair = binding.topElements[messageElemName];\n        if (soapAction) {\n          methodName = this._getMethodNameBySoapAction(binding, soapAction);\n        } else {\n          methodName = pair ? pair.methodName : messageElemName;\n        }\n        /** Style can be defined in method. If method has no style then look in binding */\n        const style = binding.methods[methodName].style || binding.style;\n        this.emit('request', obj, methodName);\n        if (headers) {\n          this.emit('headers', headers, methodName);\n        }\n        if (style === 'rpc') {\n          this._executeMethod({\n            serviceName: serviceName,\n            portName: portName,\n            methodName: methodName,\n            outputName: messageElemName + 'Response',\n            args: body[messageElemName],\n            headers: headers,\n            style: 'rpc'\n          }, req, res, callback);\n        } else {\n          this._executeMethod({\n            serviceName: serviceName,\n            portName: portName,\n            methodName: methodName,\n            outputName: pair.outputName,\n            args: body[messageElemName],\n            headers: headers,\n            style: 'document'\n          }, req, res, callback, includeTimestamp);\n        }\n      } catch (error) {\n        if (error.Fault !== undefined) {\n          return this._sendError(error.Fault, callback, includeTimestamp);\n        }\n        throw error;\n      }\n    };\n    // Authentication\n    if (typeof authenticate === 'function') {\n      let authResultProcessed = false;\n      const processAuthResult = authResult => {\n        if (authResultProcessed) {\n          return;\n        }\n        authResultProcessed = true;\n        // Handle errors\n        if (authResult instanceof Error) {\n          return this._sendError({\n            Code: {\n              Value: 'SOAP-ENV:Server',\n              Subcode: {\n                Value: 'InternalServerError'\n              }\n            },\n            Reason: {\n              Text: authResult.toString()\n            },\n            statusCode: 500\n          }, callback, includeTimestamp);\n        }\n        // Handle actual results\n        if (typeof authResult === 'boolean') {\n          if (authResult === true) {\n            try {\n              process();\n            } catch (error) {\n              if (error.Fault !== undefined) {\n                return this._sendError(error.Fault, callback, includeTimestamp);\n              }\n              return this._sendError({\n                Code: {\n                  Value: 'SOAP-ENV:Server',\n                  Subcode: {\n                    Value: 'InternalServerError'\n                  }\n                },\n                Reason: {\n                  Text: error.toString()\n                },\n                statusCode: 500\n              }, callback, includeTimestamp);\n            }\n          } else {\n            return this._sendError({\n              Code: {\n                Value: 'SOAP-ENV:Client',\n                Subcode: {\n                  Value: 'AuthenticationFailure'\n                }\n              },\n              Reason: {\n                Text: 'Invalid username or password'\n              },\n              statusCode: 401\n            }, callback, includeTimestamp);\n          }\n        }\n      };\n      const functionResult = authenticate(obj.Header && obj.Header.Security, processAuthResult, req, obj);\n      if (isPromiseLike(functionResult)) {\n        functionResult.then(result => {\n          processAuthResult(result);\n        }, err => {\n          processAuthResult(err);\n        });\n      }\n      if (typeof functionResult === 'boolean') {\n        processAuthResult(functionResult);\n      }\n    } else {\n      throw new Error('Invalid authenticate function (not a function)');\n    }\n  }\n  _getMethodNameBySoapAction(binding, soapAction) {\n    for (const methodName in binding.methods) {\n      if (binding.methods[methodName].soapAction === soapAction) {\n        return methodName;\n      }\n    }\n  }\n  _executeMethod(options, req, res, callback, includeTimestamp) {\n    options = options || {};\n    let method;\n    let body;\n    let headers;\n    const serviceName = options.serviceName;\n    const portName = options.portName;\n    const binding = this.wsdl.definitions.services[serviceName].ports[portName].binding;\n    const methodName = options.methodName;\n    const outputName = options.outputName;\n    const args = options.args;\n    const style = options.style;\n    if (this.soapHeaders) {\n      headers = this.soapHeaders.map(header => {\n        if (typeof header === 'function') {\n          return header(methodName, args, options.headers, req, res, this);\n        } else {\n          return header;\n        }\n      }).join('\\n');\n    }\n    try {\n      method = this.services[serviceName][portName][methodName];\n    } catch (error) {\n      return callback(this._envelope('', headers, includeTimestamp));\n    }\n    let handled = false;\n    const handleResult = (error, result) => {\n      if (handled) {\n        return;\n      }\n      handled = true;\n      if (error) {\n        if (error.Fault !== undefined) {\n          return this._sendError(error.Fault, callback, includeTimestamp);\n        } else {\n          return this._sendError({\n            Code: {\n              Value: 'SOAP-ENV:Server',\n              Subcode: {\n                Value: 'InternalServerError'\n              }\n            },\n            Reason: {\n              Text: error.toString()\n            },\n            statusCode: 500\n          }, callback, includeTimestamp);\n        }\n      }\n      if (style === 'rpc') {\n        body = this.wsdl.objectToRpcXML(outputName, result, '', this.wsdl.definitions.$targetNamespace);\n      } else if (style === 'document') {\n        const element = binding.methods[methodName].output;\n        body = this.wsdl.objectToDocumentXML(outputName, result, element.targetNSAlias, element.targetNamespace);\n      } else {\n        const element = binding.methods[methodName].output;\n        // Check for targetNamespace on the element\n        const elementTargetNamespace = element.$targetNamespace;\n        let outputNameWithNamespace = outputName;\n        if (elementTargetNamespace) {\n          // if targetNamespace is set on the element concatinate it with the outputName\n          outputNameWithNamespace = `${elementTargetNamespace}:${outputNameWithNamespace}`;\n        }\n        body = this.wsdl.objectToDocumentXML(outputNameWithNamespace, result, element.targetNSAlias, element.targetNamespace);\n      }\n      callback(this._envelope(body, headers, includeTimestamp));\n    };\n    if (!binding.methods[methodName].output) {\n      // no output defined = one-way operation so return empty response\n      handled = true;\n      body = '';\n      if (this.onewayOptions.emptyBody) {\n        body = this._envelope('', headers, includeTimestamp);\n      }\n      callback(body, this.onewayOptions.responseCode);\n    }\n    const methodCallback = (error, result) => {\n      if (error && error.Fault !== undefined) {\n        // do nothing\n      } else if (result === undefined) {\n        // Backward compatibility to support one argument callback style\n        result = error;\n        error = null;\n      }\n      handleResult(error, result);\n    };\n    const result = method(args, methodCallback, options.headers, req, res, this);\n    if (typeof result !== 'undefined') {\n      if (isPromiseLike(result)) {\n        result.then(value => {\n          handleResult(null, value);\n        }, err => {\n          handleResult(err);\n        });\n      } else {\n        handleResult(null, result);\n      }\n    }\n  }\n  _envelope(body, headers, includeTimestamp) {\n    const defs = this.wsdl.definitions;\n    const ns = defs.$targetNamespace;\n    const encoding = '';\n    const alias = (0, utils_1.findPrefix)(defs.xmlns, ns);\n    const envelopeDefinition = this.wsdl.options.forceSoap12Headers ? 'http://www.w3.org/2003/05/soap-envelope' : 'http://schemas.xmlsoap.org/soap/envelope/';\n    let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?>' + '<soap:Envelope xmlns:soap=\"' + envelopeDefinition + '\" ' + encoding + this.wsdl.xmlnsInEnvelope + '>';\n    headers = headers || '';\n    if (includeTimestamp) {\n      const now = new Date();\n      const created = getDateString(now);\n      const expires = getDateString(new Date(now.getTime() + 1000 * 600));\n      headers += '<o:Security soap:mustUnderstand=\"1\" ' + 'xmlns:o=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" ' + 'xmlns:u=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">' + '    <u:Timestamp u:Id=\"_0\">' + '      <u:Created>' + created + '</u:Created>' + '      <u:Expires>' + expires + '</u:Expires>' + '    </u:Timestamp>' + '  </o:Security>\\n';\n    }\n    if (headers !== '') {\n      xml += '<soap:Header>' + headers + '</soap:Header>';\n    }\n    xml += body ? '<soap:Body>' + body + '</soap:Body>' : '<soap:Body/>';\n    xml += '</soap:Envelope>';\n    return xml;\n  }\n  _sendError(soapFault, callback, includeTimestamp) {\n    let fault;\n    let statusCode;\n    if (soapFault.statusCode) {\n      statusCode = soapFault.statusCode;\n      soapFault.statusCode = undefined;\n    }\n    if ('faultcode' in soapFault) {\n      // Soap 1.1 error style\n      // Root element will be prependend with the soap NS\n      // It must match the NS defined in the Envelope (set by the _envelope method)\n      fault = this.wsdl.objectToDocumentXML('soap:Fault', soapFault, undefined);\n    } else {\n      // Soap 1.2 error style.\n      // 3rd param is the NS prepended to all elements\n      // It must match the NS defined in the Envelope (set by the _envelope method)\n      fault = this.wsdl.objectToDocumentXML('Fault', soapFault, 'soap');\n    }\n    return callback(this._envelope(fault, '', includeTimestamp), statusCode);\n  }\n  _sendHttpResponse(res, statusCode, result) {\n    if (statusCode) {\n      res.statusCode = statusCode;\n    }\n    /*\n    * Calling res.write(result) follow by res.end() will cause Node.js to use\n    * chunked encoding, while calling res.end(result) directly will cause\n    * Node.js to calculate and send Content-Length header. See\n    * nodejs/node#26005.\n    */\n    if (this.enableChunkedEncoding) {\n      res.write(result);\n      res.end();\n    } else {\n      res.end(result);\n    }\n  }\n}\nexports.Server = Server;","map":{"version":3,"names":["events_1","require","url","utils_1","zlib","error","isExpress","server","route","use","isPromiseLike","obj","then","getDateString","d","pad","n","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Server","EventEmitter","constructor","path","services","wsdl","options","suppressStack","returnFault","onewayOptions","oneWay","enableChunkedEncoding","undefined","callback","length","RegExp","source","onReady","err","all","req","res","authorizeConnection","end","_requestListener","listeners","slice","removeAllListeners","addListener","reqPath","parse","pathname","match","i","len","call","_initializeOptions","addSoapHeader","soapHeader","name","namespace","xmlns","soapHeaders","_processSoapHeader","push","changeSoapHeader","index","getSoapHeaders","clearSoapHeaders","objectToXML","_this","result","apply","arguments","attributesKey","statusCode","responseCode","emptyBody","_processRequestXml","xml","log","_process","_sendHttpResponse","Fault","_sendError","Date","toISOString","stack","message","reqParse","reqQuery","search","method","toLowerCase","startsWith","setHeader","write","toXML","headers","body","toString","chunks","gunzip","createGunzip","pipe","on","chunk","Buffer","concat","_getSoapAction","soapaction","soapAction","indexOf","input","cb","replace","xmlToObject","Body","Header","binding","methodName","serviceName","portName","includeTimestamp","Security","Timestamp","authenticate","defaultAuthenticate","response","emit","process","Error","definitions","firstPort","service","ports","port","portPathname","location","messageElemName","Object","keys","pair","topElements","_getMethodNameBySoapAction","style","methods","_executeMethod","outputName","args","authResultProcessed","processAuthResult","authResult","Code","Value","Subcode","Reason","Text","functionResult","map","header","join","_envelope","handled","handleResult","objectToRpcXML","$targetNamespace","element","output","objectToDocumentXML","targetNSAlias","targetNamespace","elementTargetNamespace","outputNameWithNamespace","methodCallback","value","defs","ns","encoding","alias","findPrefix","envelopeDefinition","forceSoap12Headers","xmlnsInEnvelope","now","created","expires","getTime","soapFault","fault","exports"],"sources":["../src/server.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}